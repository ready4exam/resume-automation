<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Resume Tailor Engine</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      padding: 40px;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 0 10px #ccc;
    }
    h2 {
      margin-top: 0;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 20px;
    }
    input, textarea, select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 6px;
      border: 1px solid #bbb;
      font-size: 15px;
      box-sizing: border-box;
    }
    textarea {
      height: 150px;
      resize: vertical;
    }
    .checkbox-row {
      margin-top: 8px;
    }
    .checkbox-row input {
      width: auto;
      transform: scale(1.1);
      margin-right: 6px;
    }
    button {
      margin-top: 30px;
      width: 100%;
      padding: 14px;
      background: #111827;
      color: white;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover {
      background: #1f2937;
    }
    #status {
      margin-top: 15px;
      font-size: 14px;
    }
  </style>
</head>
<body>

<div class="container">
  <h2>AI Resume Tailor (GitHub Issue Trigger)</h2>
  <p>
    Uploading a resume is optional â€” if you do NOT upload, the system will use
    the default base resume stored in the workflow.
  </p>

  <form id="resumeForm">
    <label>Company Name</label>
    <input id="company" required />

    <label>Job Title</label>
    <input id="jobTitle" required />

    <label>Resume Type</label>
    <select id="resumeMode">
      <option value="infra">Infra Only</option>
      <option value="hybrid">Infra + Development</option>
      <option value="dev">Development Only</option>
    </select>

    <label>Apply Methodologies</label>
    <div class="checkbox-row">
      <input type="checkbox" id="agile" /> <span>Agile</span>
    </div>
    <div class="checkbox-row">
      <input type="checkbox" id="finops" /> <span>FinOps</span>
    </div>

    <!-- ðŸ”µ OPTIONAL Upload -->
    <label>Upload Your Resume (Optional)</label>
    <input type="file" id="baseResume" accept=".txt,.md,.pdf,.docx" />

    <label>Job Description</label>
    <textarea id="jobDesc" required></textarea>

    <label>Extra Instructions (Optional)</label>
    <textarea id="extra"></textarea>

    <button type="submit">Create GitHub Issue</button>
  </form>

  <p id="status"></p>
</div>

<script>
  const repoFullName = "ready4exam/resume-automation";

  document.getElementById("resumeForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const company = document.getElementById("company").value.trim();
    const jobTitle = document.getElementById("jobTitle").value.trim();
    const resumeMode = document.getElementById("resumeMode").value;
    const jobDesc = document.getElementById("jobDesc").value.trim();
    const extra = document.getElementById("extra").value.trim();
    const fileInput = document.getElementById("baseResume");

    const agile = document.getElementById("agile").checked;
    const finops = document.getElementById("finops").checked;

    const statusEl = document.getElementById("status");

    if (!company || !jobTitle || !jobDesc) {
      statusEl.innerText = "âŒ Company, Job Title, and Job Description are required.";
      return;
    }

    let encodedResume = "(none)";

    // ðŸ”µ ONLY use uploaded resume if present
    if (fileInput.files.length > 0) {
      const file = fileInput.files[0];
      const text = await file.text();

      encodedResume =
        "-----BEGIN UPLOADED RESUME-----\n" +
        text +
        "\n-----END UPLOADED RESUME-----";
    }

    const methodologies = [];
    if (agile) methodologies.push("Agile");
    if (finops) methodologies.push("FinOps");

    // GitHub Issue Body
    const bodyLines = [
      `Company: ${company}`,
      `Job Title: ${jobTitle}`,
      `Resume Mode: ${resumeMode}`,
      `Methodologies: ${methodologies.join(",")}`,
      "",
      "Uploaded Resume (Optional):",
      encodedResume,
      "",
      "Job Description:",
      jobDesc,
      "",
      "Extra:",
      extra || "(none)"
    ];

    const title = `Tailor Resume: ${jobTitle} at ${company}`;
    const body = bodyLines.join("\n");

    const url =
      `https://github.com/${repoFullName}/issues/new` +
      `?title=${encodeURIComponent(title)}` +
      `&body=${encodeURIComponent(body)}`;

    statusEl.innerHTML =
      "âœ… Opening GitHub Issue page in a new tab...<br>" +
      "Click <b>Submit new issue</b> to start the resume generation.";

    window.open(url, "_blank");
  });
</script>

</body>
</html>
