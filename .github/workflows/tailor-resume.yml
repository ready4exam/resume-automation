name: Tailor Resume

on:
  workflow_dispatch:
    inputs:
      company:
        description: "Company name"
        required: true
      job_title:
        description: "Job title"
        required: true
      job_description:
        description: "Paste the full Job Description"
        required: true
      extra:
        description: "Extra tailoring notes (optional)"
        required: false
        default: ""

jobs:
  tailor:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Node
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install dependencies
        run: npm install

      - name: Save JD to file
        run: |
          mkdir -p tmp
          echo "${{ github.event.inputs.job_description }}" > tmp/jd.txt

      - name: Run resume tailoring script
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          node tailor_resume.mjs \
            --company "${{ github.event.inputs.company }}" \
            --job-title "${{ github.event.inputs.job_title }}" \
            --job-desc-file "tmp/jd.txt" \
            --extra "${{ github.event.inputs.extra }}"

      - name: Upload tailored resume
        uses: actions/upload-artifact@v4
        with:
          name: tailored-resume
          path: output/
